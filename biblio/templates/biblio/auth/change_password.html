{% extends 'biblio/base.html' %}
{% load static %}

{% block title %}Modifier le mot de passe - Bibliothèque MEF{% endblock %}

{% block content %}
<div class="min-h-[80vh] flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 bg-white">
    <div class="max-w-md w-full space-y-8 bg-white p-8 rounded-xl border border-gray-100">
        <div>
            <div class="mx-auto h-12 w-12 bg-primary/10 rounded-full flex items-center justify-center mb-4">
                <i class="h-6 w-6 text-primary" data-lucide="lock"></i>
            </div>
            <h2 class="mt-2 text-center text-3xl font-extrabold text-gray-900">
                Modifier le mot de passe
            </h2>
            <p class="mt-2 text-center text-sm text-gray-600">
                Entrez votre nouveau mot de passe ci-dessous
            </p>
        </div>
        
        <form class="mt-8 space-y-6" action="{% url 'change_password' %}" method="POST">
            {% csrf_token %}
            
            {% if form.errors %}
            <div class="rounded-md bg-red-50 p-4 mb-4">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <i class="h-5 w-5 text-red-400" data-lucide="x-circle"></i>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-red-800">
                            Des erreurs sont survenues
                        </h3>
                        <div class="mt-2 text-sm text-red-700">
                            <ul class="list-disc pl-5 space-y-1">
                                {% for field in form %}
                                    {% for error in field.errors %}
                                        <li>{{ error }}</li>
                                    {% endfor %}
                                {% endfor %}
                                {% for error in form.non_field_errors %}
                                    <li>{{ error }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <div class="space-y-4">
                {% for field in form %}
                <div>
                    <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                        {{ field.label }}
                    </label>
                    <div class="relative">
                        <input type="password" 
                               name="{{ field.name }}" 
                               id="{{ field.id_for_label }}" 
                               class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"
                               {% if field.field.required %}required{% endif %}>
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center cursor-pointer toggle-password" data-target="{{ field.id_for_label }}">
                            <i class="h-4 w-4 text-gray-400 hover:text-gray-600" data-lucide="eye"></i>
                        </div>
                    </div>
                    {% if field.help_text %}
                    <p class="mt-1 text-xs text-gray-500">{{ field.help_text|safe }}</p>
                    {% endif %}
                </div>
                {% endfor %}
            </div>

            <div class="flex items-center justify-between gap-4 mt-6">
                <a href="{% url 'profile' %}" class="w-full flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-colors duration-200">
                    Annuler
                </a>
                <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-colors duration-200">
                    <i class="h-4 w-4 mr-2" data-lucide="check"></i> Enregistrer
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    // Toggle password visibility
    document.querySelectorAll('.toggle-password').forEach(button => {
        button.addEventListener('click', function() {
            const targetId = this.getAttribute('data-target');
            const input = document.getElementById(targetId);
            const icon = this.querySelector('i'); // Assurez-vous que l'icône est à l'intérieur du bouton
            
            if (input.type === 'password') {
                input.type = 'text';
                // Changer l'icône en eye-off (si vous utilisez Lucide ou similaire)
                // Ici je suppose que vous relancez lucide.createIcons() ou changez l'attribut data-lucide
                // Pour une implémentation simple sans re-render complet :
                // icon.setAttribute('data-lucide', 'eye-off'); 
                // Mais avec Lucide JS, il faut souvent reconstruire. 
                // Une méthode simple est de changer la classe ou le contenu si c'est du SVG inline, 
                // ou juste changer l'attribut et rappeler createIcons si possible.
                
                // Si SVG inline déjà rendu :
                 // (C'est compliqué de changer l'icône SVG dynamiquement sans re-parser)
                 // On va laisser l'icône 'eye' pour l'instant ou essayer de changer la couleur pour indiquer l'état
                 this.classList.add('text-primary');
            } else {
                input.type = 'password';
                this.classList.remove('text-primary');
            }
        });
    });

    if (typeof lucide !== 'undefined') {
        lucide.createIcons();
    }
</script>
{% endblock %}
