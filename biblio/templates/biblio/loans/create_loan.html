{% extends 'biblio/base.html' %}

{% block content %}
<div class="p-6">
    <div class="mx-auto  overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-xl font-bold text-primary flex items-center">
                <i class="w-5 h-5 mr-2" data-lucide="book-plus"></i>
                Nouveau prêt
            </h2>
        </div>
        
        <form method="POST" class="p-6 space-y-4">
            {% csrf_token %}
            
            {% if form.non_field_errors %}
            <div class="bg-red-50 text-red-700 p-3 rounded-md border border-red-200 text-sm">
                {{ form.non_field_errors }}
            </div>
            {% endif %}

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Livre à emprunter</label>
                {{ form.book }}
                {% if form.book.errors %}
                <p class="mt-1 text-sm text-red-600">{{ form.book.errors.0 }}</p>
                {% endif %}
                <p class="mt-1 text-xs text-gray-500">Seuls les livres physiques disponibles sont listés (les livres numériques ne peuvent pas être empruntés).</p>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Utilisateur (Emprunteur)</label>
                {{ form.user }}
                {% if form.user.errors %}
                <p class="mt-1 text-sm text-red-600">{{ form.user.errors.0 }}</p>
                {% endif %}
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Date de prêt</label>
                    {{ form.loan_date }}
                    {% if form.loan_date.errors %}
                    <p class="mt-1 text-sm text-red-600">{{ form.loan_date.errors.0 }}</p>
                    {% endif %}
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Date de retour prévue</label>
                    {{ form.due_date }}
                    {% if form.due_date.errors %}
                    <p class="mt-1 text-sm text-red-600">{{ form.due_date.errors.0 }}</p>
                    {% endif %}
                    <p class="mt-1 text-xs text-gray-500">Laisser vide pour +14 jours par défaut.</p>
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Notes (optionnel)</label>
                {{ form.notes }}
                {% if form.notes.errors %}
                <p class="mt-1 text-sm text-red-600">{{ form.notes.errors.0 }}</p>
                {% endif %}
            </div>

            <div class="flex justify-end space-x-3 pt-4 border-t border-gray-100 mt-6">
                <a href="{% if user.profile.is_admin %}{% url 'loan_list' %}{% else %}{% url 'my_loans' %}{% endif %}" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200">
                    Annuler
                </a>
                <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary-dark flex items-center">
                    <i class="w-4 h-4 mr-2" data-lucide="check"></i>
                    Créer le prêt
                </button>
            </div>
        </form>
    </div>
</div>

{% block extra_js %}
<script>
    if (typeof lucide !== 'undefined') {
        lucide.createIcons();
    }
</script>
{% endblock %}
{% endblock %}
